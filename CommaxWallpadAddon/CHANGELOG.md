# Changelog

## [1.6.2] - 2025-01-09

### 개선됨
- EW11 응답 없을 때 HA 알림생성 - 기본값 20분으로 변경
  - 저희집 EW11은 한번 응답없으면 7분정도 후에 다시 응답오더라구요.. elfin_reboot_interval 값을 조절하면 HA알림 주기를 늦추거나 앞당길 수 있습니다. (대략 elfin_reboot_interval x 20회 (초))
- 130ms이상 휴식 상태일때 명령 전송 기능 옵션화
  - 월패드가 패킷전송을 잠시 쉴 때 (저희집은 700ms정도..) 애드온에서 생성한 명령패킷을 전송하는 기능을 옵션화했습니다.
  - send_command_on_idle 옵션을 True로 해두면 월패드가 쉴때 명령을 전송하므로 월패드 부담을 줄여줄 것 같습니다. (그냥 예상입니다.)
  - 기능을 꺼두면 즉시 명령패킷을 전송하므로 보다 빠른 응답을 기대할 수 있을 것 같습니다. 다만 max_send_count를 기본값보다 높여야 씹힐 확률이 낮아집니다. (30 정도)
  - 실제로 응답속도가 빨라졌냐면 그건 잘 모르겠습니다..

## [1.6.1] - 2025-01-07

### 주의
⚠️ 이 버전은 설정 구조가 변경되었습니다. 업데이트 후 설정을 다시 확인해주세요.
    - mqtt 설정은 HA에 애드온으로 mqttbroker를 사용중인경우 변경할 필요가 없습니다.
    - elfin 설정은 자동재시작 기능을 사용하지 않는경우 필요가 없습니다.

### 추가됨
- 기본 mqtt 서버를 사용하도록 변경.
  - 더이상 서버주소, 아이디, 패스워드를 설정할 필요가 없습니다.
- 애드온 설정 변경
  - 관련설정별 하위설정으로 묶었습니다.

### 개선됨
- EW11 응답 없을 때 재시작으로 해결 안되면 HA 알림 생성
- 웹UI 개선
  - 다크모드추가
  - 기능오류 수정

## [1.6.0] - 2025-01-04

### 개선됨
- 누락되었던 제어기능 추가 - 조명차단기, 콘센트, 가스밸브, 엘리베이터
- 테스트코드 추가
- 모듈 구조 및 파일 처리 개선
  - Dockerfile 업데이트
    - PYTHONPATH 설정 추가
    - 모듈 문법을 사용한 명령 실행 방식으로 변경
  - 코드 구조 개선
    - main.py의 상대 임포트 적용
    - WallpadController의 커스텀 패킷 파일 경로 처리 개선
    - YAML 파일 인코딩 처리 강화
  - EV 명령 구조 업데이트
    - 헤더 충돌 방지
    - 주석 명확성 개선
  - config.json 설정 설명 개선

## [1.5.14] - 2025-01-04

### 개선됨
- 패킷 구조 및 기기 제어 기능 강화
  - Outlet 전력량 처리 로직 개선
  - 커스텀 패킷 구조 관리 기능 강화
    - UI에 초기화 버튼 추가
- Dockerfile 의존성 정리

## [1.5.13] - 2025-01-03

### 개선됨
- 예상 상태 패킷 생성 관련 오류 수정
- 예상 상태 없는 경우에도 명령 전송

## [1.5.12] - 2025-01-03

### 개선됨
- 기기 제어 및 패킷 처리 개선
  - WallpadController의 기기 검색 및 MQTT 처리 로직 개선

## [1.5.11] - 2025-01-03

### 변경됨
- 데이터 구조 및 통신 방식 개선
  - WebSocket 지원 제거 및 실시간 패킷 데이터 조회 폴링방식으로 전환
  - UI 개선 및 폴링 메커니즘 강화
- Elfin 데이터 처리중 deviceId 없는 경우 예외처리

## [1.5.10a] - 2025-01-02

### 개선됨
- 웹UI 설정 페이지 개선

## [1.5.10] - 2025-01-01

### 개선됨
- webUI상 설정 저장 및 검증 기능 강화

## [1.5.9] - 2025-01-01

### 개선됨
- 웹 서버 기능 및 UI 상호작용 강화
  - 기기 새로고침 기능 구현

## [1.5.8] - 2025-01-01

### 개선됨
- 큐 처리 로직 개선: 큐 재시도가 완료된 후 다음 큐를 실행하도록 개선
- 온도관련 패킷 처리 로직 개선
- 큐 처리 간격 조정 (150ms -> 130ms)이상 여유있을 때 큐를 처리함

### 수정됨
- 온도값 변환 함수 오류 수정

## [1.5.7] - 2024-12-31

### 개선됨
- 웹UI 패킷 처리 로직 최적화

## [1.5.6] - 2024-12-31

### 수정됨
- 온도조절기 예상패킷 생성이 제대로 되지 않던 문제 수정
- 중복 코드 제거 및 참조 업데이트
- 코드 가독성 및 유지보수성 향상

## [1.5.5] - 2024-12-31

### 추가됨
- 설정 및 기능 개선
  - 최소 수신 횟수를 설정하여 예상패킷이 이 횟수만큼 수신되어야 명령 패킷 전송에 성공한것으로 판단합니다.
  - 새로운 설정 옵션 추가
    - min_receive_count: 패킷 전송 성공 판단을 위한 최소 수신 횟수
    - climate_min_temp: 온도조절기 최저 온도 제한 (기본 값 5°C)
    - climate_max_temp: 온도조절기 최고 온도 제한 (기본 값 40°C)
  - 웹 인터페이스 개선
    - 실시간 패킷 로그 일시정지/재개 기능
    - 패킷 로그 다운로드 기능

## [1.5.4] - 2024-12-27

### 변경됨
- 애드온 구조 및 API 상호작용 개선
  - Dockerfile 최적화
    - slim-bookworm 기반 Python 이미지로 변경
  - 설정 저장 로직 개선
    - bashio_wrapper.sh 스크립트 제거
    - 직접 API 요청 방식으로 변경
  - 웹 서버 기능 강화
    - API 호출 실패 시 에러 처리 개선
    - vendor 설정 변경 시 현재 설정 확인 로직 추가

## [1.5.3] - 2024-12-27

### 변경됨
- 애드온 구성 및 설정 저장 로직 개선
  - Dockerfile alpine 기반 Python 이미지로 변경
  - 설정 저장 로직 개선
    - 변경된 설정만 저장하도록 수정
    - 설정 저장 후 애드온 자동 재시작
    