# Changelog

## [1.6.2] - 2025-01-09

### 개선됨
- EW11 응답 없을 때 HA 알림생성 - 기본값 20분으로 변경
  - 저희집 EW11은 한번 응답없으면 7분정도 후에 다시 응답오더라구요.. elfin_reboot_interval 값을 조절하면 HA알림 주기를 늦추거나 앞당길 수 있습니다. (대략 elfin_reboot_interval x 20회 (초))
  - elfin_unavailable_notification 설정으로 on/off 시킬 수 있습니다.
- EW11 응답 없을 때 구성요소 사용 불가 표시
  - HA에 availablity topic을 통해 EW11 응답이 없을 때(자동 재부팅 트리거될 때) 구성요소들 사용불가 표시합니다.
  - 자동화에 사용할 수 있을 듯 합니다. (예를들어, `Light1이 사용 불가가 되었을 때 -> EW11전원플러그 껏다가 1초후 다시 켜기`와 같은 자동화를 설정하면 EW11이 응답할때까지 7분가량 기다리지 않고 바로 복구될것으로 예상됨.)
- 월패드 휴식 상태일때 명령 전송 기능 옵션화
  - 월패드가 패킷전송을 잠시 쉴 때 (>130ms, 저희집은 700ms정도..) 애드온에서 생성한 명령패킷을 전송하는 기능을 옵션화했습니다.
  - send_command_on_idle 옵션을 True로 해두면 월패드가 쉴때 명령을 전송하므로 월패드 부담을 줄여줄 것 같습니다. (그냥 예상입니다.)
  - false로 꺼두면 즉시 명령패킷을 전송하므로 보다 빠른 응답을 기대할 수 있을 것 같습니다. 다만 max_send_count를 기본값보다 높여야 씹힐 확률이 낮아집니다. (30 정도)
  - 실제로 응답속도가 빨라졌냐면 그건 잘 모르겠습니다..

### 수정됨
- 연속으로 이전 상태로 돌아가는 명령패킷이 들어왔을 때 이전 상태 패킷이 남아있어 명령 재전송이 조기종료되는 현상 수정.
  - 예: 온도변경 19 -> 20 -> 19에서 recv_data에 19도일때 상태패킷 남아있어 20->19 명령의 예상 상태패킷이 아직 안왔음에도 성공으로 판단하여 재전송 중지되었으나 수정함.

## [1.6.1] - 2025-01-07

### 주의
⚠️ 이 버전은 설정 구조가 변경되었습니다. 업데이트 후 설정을 다시 확인해주세요.
    - mqtt 설정은 HA에 애드온으로 mqttbroker를 사용중인경우 변경할 필요가 없습니다.
    - elfin 설정은 자동재시작 기능을 사용하지 않는경우 필요가 없습니다.

### 추가됨
- 기본 mqtt 서버를 사용하도록 변경.
  - 더이상 서버주소, 아이디, 패스워드를 설정할 필요가 없습니다.
- 애드온 설정 변경
  - 관련설정별 하위설정으로 묶었습니다.

### 개선됨
- EW11 응답 없을 때 재시작으로 해결 안되면 HA 알림 생성
- 웹UI 개선
  - 다크모드추가
  - 기능오류 수정

## [1.6.0] - 2025-01-04

### 개선됨
- 누락되었던 제어기능 추가 - 조명차단기, 콘센트, 가스밸브, 엘리베이터
- 테스트코드 추가
- 모듈 구조 및 파일 처리 개선
  - Dockerfile 업데이트
    - PYTHONPATH 설정 추가
    - 모듈 문법을 사용한 명령 실행 방식으로 변경
  - 코드 구조 개선
    - main.py의 상대 임포트 적용
    - WallpadController의 커스텀 패킷 파일 경로 처리 개선
    - YAML 파일 인코딩 처리 강화
  - EV 명령 구조 업데이트
    - 헤더 충돌 방지
    - 주석 명확성 개선
  - config.json 설정 설명 개선

## [1.5.14] - 2025-01-04

### 개선됨
- 패킷 구조 및 기기 제어 기능 강화
  - Outlet 전력량 처리 로직 개선
  - 커스텀 패킷 구조 관리 기능 강화
    - UI에 초기화 버튼 추가
- Dockerfile 의존성 정리
